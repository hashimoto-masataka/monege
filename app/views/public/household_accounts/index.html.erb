<h2>投稿一覧</h2>
<%= link_to "新規登録", new_household_account_path %>
    <% @households.each do |household| %>
     <div class="row">
      <div class="col-md-3">ニックネーム</div>
      <div class="col-md-9"><%= household.user.name %></div>
     </div>
     <% sum = household.household_accounts.sum(:target_price) %>
     <%= sum %>
    <!--@householdsが変動するためコントローラーではなくviewに記載 -->
     <% household.household_accounts.each do |household_account| %>
      <div class="row">
       <div class="col-md-3">
        <div class= "pie_chart" style='width:200px; height: 200px;'>
               <canvas id ="pie_chart" ></canvas>
            </div>
       </div>
       <div class="col-md-9">
        <span style="color: <%= household_account.color %>"><%= household_account.category_name %></span>
        &yen;<%= "#{household_account.target_price.to_s(:delimited)} (#{((household_account.target_price.to_f / sum.to_f) * 100).round(2)} %)" %>
        <!-- &yenは￥の文字化けを防ぐために使用。#{}はrubyの文字式を入れるためのもの。roundは（）内以下の小数点を四捨五入してくれる-->
       </div>
      </div>
     <% end %>
    <% end %>



<script>

const category_data = {
  labels: [
    <% @categories.all.each do | category| %>
      '<%= category.category_name %>',
    <% end %>
    ],
  datasets: [
    {
      label: 'カテゴリー表',
      data: [
        <% Category.all.each do | category| %>
          '<%= category.target_price %>',
        <% end %>
      ],
    }
  ]
};

const pie_ctx = document.getElementsByClassName('pie_chart');
new Chart(pie_ctx, {
    type: 'pie',
    data: category_data,
    options: {
  /*    scales: {
        y: {
          beginAtZero: true
        }
      }
      */
    }
  });
const column_ctx = document.getElementById('column_chart');
new Chart(column_ctx, {
    type: 'bar',
    data: category_data,
    options: {
  /*    scales: {
        y: {
          beginAtZero: true
        }
      }
      */
    }
  });

</script>
