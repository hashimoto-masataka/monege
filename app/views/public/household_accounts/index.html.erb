<div class="container">
<h2>ÊäïÁ®ø‰∏ÄË¶ß</h2>
<%= link_to "Êñ∞Ë¶èÁôªÈå≤", new_household_account_path %>
    <% @households.each do |household| %>

     <div class="row">
      <div class="col-md-3">„Éã„ÉÉ„ÇØ„Éç„Éº„É†</div>
      <div class="col-md-9"><%= household.user.name %></div>
     </div>
     <% sum = household.household_accounts.sum(:target_price) %>
     <%= sum %>
      <div class= "chart" style='width:200px; height: 200px;'>
               <canvas class ="pie" ></canvas>
            </div>

    <!--@households„ÅåÂ§âÂãï„Åô„Çã„Åü„ÇÅ„Ç≥„É≥„Éà„É≠„Éº„É©„Éº„Åß„ÅØ„Å™„Åèview„Å´Ë®òËºâ -->
     <% household.household_accounts.each do |household_account| %>
      <div class="row">
       <div class="col-md-3">
        <!--<div class= "chart" style='width:200px; height: 200px;'>-->
        <!--       <canvas class ="pie" ></canvas>-->
        <!--    </div>-->
       </div>
       <div class="col-md-9">
        <span style="color: <%= household_account.color %>"><%= household_account.category_name %></span>
        &yen;<%= "#{household_account.target_price.to_s(:delimited)} (#{((household_account.target_price.to_f / sum.to_f) * 100).round(2)} %)" %>
         <!--&yen„ÅØÔø•„ÅÆÊñáÂ≠óÂåñ„Åë„ÇíÈò≤„Åê„Åü„ÇÅ„Å´‰ΩøÁî®„ÄÇ#{}„ÅØruby„ÅÆÊñáÂ≠óÂºè„ÇíÂÖ•„Çå„Çã„Åü„ÇÅ„ÅÆ„ÇÇ„ÅÆ„ÄÇround„ÅØÔºàÔºâÂÜÖ‰ª•‰∏ã„ÅÆÂ∞èÊï∞ÁÇπ„ÇíÂõõÊç®‰∫îÂÖ•„Åó„Å¶„Åè„Çå„Çã-->
         <% if household_account.favorited_by?(current_user) %>
          <p><%= link_to household_account_favorites_path(household_account), method: :delete do %>
          ‚ù§Ô∏è<%= household_account.favorites.count %>„ÅÑ„ÅÑ„Å≠
          <% end %></p>
        <% else %>
          <p><%= link_to household_account_favorites_path(household_account), method: :post do %>
          ü§ç<%= household_account.favorites.count %>„ÅÑ„ÅÑ„Å≠
          <% end %></p>
        <% end %>

       </div>
      </div>
     <% end %>
    <% end %>
</div>


<script>

const category_data = {
  labels: [
    <% @categories.all.each do | household_account| %>
      '<%= household_account.category_name %>',
    <% end %>
    ],
  datasets: [
    {
      label: '„Ç´„ÉÜ„Ç¥„É™„ÉºË°®',
      data: [
        <% @categories.all.each do | household_account| %>
          '<%= household_account.target_price %>',
        <% end %>
      ],
    }
  ]
};

const elements = document.getElementsByClassName('pie');
for(let i = 0; i < elements.length; i++) {
  new Chart(elements[i], {
      type: 'pie',
      data: category_data,
      options: {
    /*    scales: {
          y: {
            beginAtZero: true
          }
        }
        */
      }
    });
}
// elements.forEach((element) => {



// })
// new Chart(xxxxx, {
//     type: 'pie',
//     data: category_data,
//     options: {
//   /*    scales: {
//         y: {
//           beginAtZero: true
//         }
//       }
//       */
//     }
//   });


</script>
