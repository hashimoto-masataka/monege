
<div class="container-fluie">
	<div class="row">
	  <div class = "col-6 col- offset-2 ">
	    <h3 class= "total mt-5 text-center">
	        <%= link_to users_my_page_path(month: @month.prev_month) do %>
	          <i class="fa-solid fa-arrow-left"></i>
	        <% end %>
	        <%= I18n.l @current_month_beginning %> ~
	        <%= I18n.l @current_month_end %>
	        <%= link_to users_my_page_path(month: @month.next_month) do %>
	          <i class="fa-solid fa-arrow-right"></i>
	        <% end %>
	    </h3>
		<table class="table table-bordered table-hover">
	      <thead>
        	<tr>
              <th class= "text-center">収入</th>
              <th class= "text-center">支出</th>
              <th class= "text-center">貯金</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class= "text-center text-success"><%=@sum_price_income %></p></td>
              <td class= "text-center text-danger"><%= @sum_price_expense %></td>
              <td class= "text-center"></td>
            </tr>
          </tbody>
        </table>
      </div>

			<div class = "col-4 offset-2 mt-5">
				<h2>目標家計簿</h2>
				<% if current_user.category_ids.present? %>
            <div class= "chart" style='width:200px; height: 200px;'>
               <canvas id ="pie" ></canvas>
          </div>
        <% else %>
            <td>未設定</td>
        <% end %>

			</div>
			<div class = "col-4 mt-5">
				<h2>現在の家計簿</h2>
					<% if @expenses.present? %>
            <div class= "chart" style='width:200px; height: 200px;'>
               <canvas id ="chart" ></canvas>
       		 </div>
        <% else %>
            <td>未設定</td>
        <% end %>

			</div>


	</div>
	<div class = "row">
		<div class="col-md-9 offset-1">

			<h2 class="head-line col-md-6 text-center title_h2 m-4">マイページ</h2>
			 <%= link_to "ユーザー一覧",users_path, 'data-turbolinks': false %>
				<strong>登録情報</strong>
					<% if current_user.name != "guestuser" %>
						<p><%=link_to"参考にしたユーザー",user_followings_path(@user) %></p>
						<p><%=link_to"あなたを参考にしたユーザー",user_followers_path(@user) %></p>
						<p><%= link_to " 編集する", users_information_edit_path, class: "glyphicon glyphicon-pencil btn btn-success ml-4" %></p>
					<% end %>
			<table class="table table-bordered table-condensed" >
				<tbody>
					<tr>
						<td class="info">氏名</td>
						<td class="text-left "><%= @user.name %>
					</tr>
					<tr>
						<td class="info">年代</td>
						<td class="text-left"><%= @user.age %></td>
					</tr>
					<tr>
						<td class="info">仕事</td>
						<td class="text-left"><%= @user.job %></td>
					</tr>
					<tr>
						<td class="info">年収</td>
						<td class="text-left"><%= @user.annual_income %></td>
					</tr>
					<tr>
						<td class="info">都道府県</td>
						<td class="text-left"><%= @user.prefecture %></td>
					</tr>
					<tr>
						<td class="info">メールアドレス</td>
						<td class="text-left"><%= @user.email %></td>
					</tr>
					<tr>
						<td class="info">家計簿ステータス</td>
						<% if current_user.status == false %>
					  	<td class="text-left">家計簿は非公開です</td>
						<% else %>
						  <td class="text-left">家計簿を公開中</td>
						<% end %>
					</tr>

				</tbody>
			</table>
		</div>
	</div>
</div>


<script>

const category_data = {
  labels: [
    <% @categories.each do | category| %>
      '<%= category.category_name %>',
    <% end %>
    ],
  datasets: [
    {
      label: 'カテゴリー表',
      data: [
        <% @categories.each do | category| %>
          '<%= category.target_price %>',
        <% end %>
      ],
    }
  ]
};

const pie_ctx = document.getElementById('pie');
new Chart(pie_ctx, {
    type: 'pie',
    data: category_data,
    options: {
  /*    scales: {
        y: {
          beginAtZero: true
        }
      }
      */
    }
  });

const expense_data = {
  labels: [
    <% @expenses.all.each do |expense| %>
      '<%= expense.category.category_name %>',
    <% end %>
    ],
  datasets: [
    {
      label: '金額',
      data: [
        <% @expenses.each do |expense| %>
          '<%= expense.price %>',
        <% end %>
      ],
    }
  ]
};

const expense_ctx = document.getElementById('chart');
new Chart(expense_ctx, {
    type: 'pie',
    data: expense_data,
    options: {
  /*    scales: {
        y: {
          beginAtZero: true
        }
      }
      */
    }
  });


</script>